<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rajwadi Security</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #0a0a23;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
        }
        .sidebar {
            width: 250px;
            background: #181830;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            padding: 1rem;
            border-right: 1px solid #00ffae22;
            box-shadow: 0 0 20px #00ffae11;
        }
        .sidebar-header {
            padding: 1rem 0;
            text-align: center;
            border-bottom: 1px solid #00ffae22;
            margin-bottom: 1rem;
        }
        .sidebar-header h3 {
            color: #00ffae;
            font-size: 1.5rem;
            margin: 0;
            text-shadow: 0 0 10px #00ffae44;
        }
        .nav-item {
            margin: 0.5rem 0;
        }
        .nav-link {
            color: #e0e0e0;
            padding: 0.8rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        .nav-link:hover {
            background: #00ffae22;
            color: #00ffae;
        }
        .nav-link.active {
            background: linear-gradient(90deg, #00ffae22 0%, #0066ff22 100%);
            color: #00ffae;
            box-shadow: 0 0 10px #00ffae22;
        }
        .nav-link i {
            width: 20px;
            text-align: center;
        }
        .main-content {
            margin-left: 250px;
            padding: 2rem;
            width: calc(100% - 250px);
        }
        .dashboard-header {
            background: linear-gradient(90deg, #00ffae 0%, #0066ff 100%);
            color: #fff;
            padding: 2rem 1rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 0 30px #00ffae44;
            text-align: center;
        }
        .dashboard-header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            letter-spacing: 2px;
            text-shadow: 0 0 10px #00ffae;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 2rem;
        }
        .card {
            background: #181830;
            border: 1px solid #00ffae44;
            border-radius: 1rem;
            box-shadow: 0 0 10px #00ffae22;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 0 30px #00ffae55;
        }
        .card-header {
            background: #10101a;
            border-bottom: 1px solid #00ffae22;
            color: #00ffae;
            font-weight: bold;
            font-size: 1.2rem;
            border-radius: 1rem 1rem 0 0;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00ffae;
            text-shadow: 0 0 10px #00ffae44;
        }
        .metric-label {
            font-size: 0.9rem;
            color: #a0a0a0;
        }
        .system-info {
            background: #222244;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .system-info p {
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }
        .process-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .process-item {
            padding: 0.5rem;
            border-bottom: 1px solid #00ffae22;
        }
        .process-item:last-child {
            border-bottom: none;
        }
        .badge {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
            border-radius: 1rem;
        }
        .neon {
            color: #00ffae;
            text-shadow: 0 0 10px #00ffae, 0 0 20px #00ffae44;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="col-md-2 sidebar">
        <h4 class="mb-4">Rajwadi Security</h4>
        <nav class="nav flex-column">
            <a class="nav-link active" href="/">
                <i class="fas fa-chart-line"></i> Dashboard
            </a>
            <a class="nav-link" href="/eep">
                <i class="fas fa-shield-alt"></i> EEP
            </a>
            <a class="nav-link" href="/log">
                <i class="fas fa-list"></i> Log
            </a>
            <a class="nav-link" href="/playbook">
                <i class="fas fa-book"></i> Playbook
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="dashboard-header">
            <h1><i class="fas fa-shield-alt neon"></i> Rajwadi Security</h1>
            <p class="lead">Real-time System Monitoring & Security Management</p>
        </div>
        
        <!-- System Information -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-server"></i> System Information
            </div>
            <div class="card-body">
                <div class="system-info" id="system-info">
                    <p><i class="fas fa-desktop"></i> <span id="hostname">Loading...</span></p>
                    <p><i class="fas fa-microchip"></i> <span id="processor">Loading...</span></p>
                    <p><i class="fas fa-network-wired"></i> <span id="ip-address">Loading...</span></p>
                    <p><i class="fas fa-windows"></i> <span id="os">Loading...</span></p>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- CPU Monitoring -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-microchip"></i> CPU Monitoring
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <div class="metric-value" id="cpu-usage">0%</div>
                            <div class="metric-label">Usage</div>
                        </div>
                        <div class="col-6">
                            <div class="metric-value" id="cpu-freq">0 MHz</div>
                            <div class="metric-label">Frequency</div>
                        </div>
                    </div>
                    <canvas id="cpuChart"></canvas>
                </div>
            </div>

            <!-- Memory Monitoring -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-memory"></i> Memory Monitoring
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <div class="metric-value" id="memory-usage">0%</div>
                            <div class="metric-label">Usage</div>
                        </div>
                        <div class="col-6">
                            <div class="metric-value" id="memory-available">0 GB</div>
                            <div class="metric-label">Available</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="progress" style="height: 20px;">
                            <div id="memory-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                    <canvas id="memoryChart"></canvas>
                </div>
            </div>

            <!-- Network Monitoring -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-network-wired"></i> Network Monitoring
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <div class="metric-value" id="network-connections">0</div>
                            <div class="metric-label">Active Connections</div>
                        </div>
                        <div class="col-6">
                            <div class="metric-value" id="network-interface">-</div>
                            <div class="metric-label">Active Interface</div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Interface</th>
                                    <th>Sent</th>
                                    <th>Received</th>
                                </tr>
                            </thead>
                            <tbody id="network-stats"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Process Monitoring -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-tasks"></i> Top Processes
                </div>
                <div class="card-body">
                    <div class="process-list" id="process-list">
                        <!-- Process items will be added here -->
                    </div>
                </div>
            </div>

            <!-- Threat Monitoring -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-radar"></i> Threat Monitoring
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <span class="fw-bold">Threat Level:</span>
                        <span id="threat-level" class="badge bg-success">Normal</span>
                    </div>
                    <div class="mb-3">
                        <span class="fw-bold">System Status:</span>
                        <span id="system-status" class="badge bg-info">Normal</span>
                    </div>
                    <canvas id="threatChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize charts
        let cpuChart, memoryChart, threatChart;

        function initCharts() {
            // CPU Chart
            const cpuCtx = document.getElementById('cpuChart').getContext('2d');
            cpuChart = new Chart(cpuCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU Usage',
                        data: [],
                        borderColor: '#00ffae',
                        backgroundColor: 'rgba(0,255,174,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#00ffae' } },
                        title: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#00ffae' },
                            grid: { color: '#00ffae22' }
                        },
                        x: {
                            ticks: { color: '#00ffae' },
                            grid: { color: '#00ffae22' }
                        }
                    }
                }
            });

            // Memory Chart
            const memoryCtx = document.getElementById('memoryChart').getContext('2d');
            memoryChart = new Chart(memoryCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Memory Usage',
                        data: [],
                        borderColor: '#0066ff',
                        backgroundColor: 'rgba(0,102,255,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#0066ff' } },
                        title: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#0066ff' },
                            grid: { color: '#0066ff22' }
                        },
                        x: {
                            ticks: { color: '#0066ff' },
                            grid: { color: '#0066ff22' }
                        }
                    }
                }
            });

            // Threat Chart
            const threatCtx = document.getElementById('threatChart').getContext('2d');
            threatChart = new Chart(threatCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Threat Level',
                        data: [],
                        borderColor: '#ff4444',
                        backgroundColor: 'rgba(255,68,68,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#ff4444' } },
                        title: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 3,
                            ticks: {
                                color: '#ff4444',
                                callback: function(value) {
                                    return ['Normal','Low','Medium','High'][value];
                                }
                            },
                            grid: { color: '#ff444422' }
                        },
                        x: {
                            ticks: { color: '#ff4444' },
                            grid: { color: '#ff444422' }
                        }
                    }
                }
            });
        }

        function updateDashboard() {
            fetch('/api/security/metrics')
                .then(res => res.json())
                .then(data => {
                    // Update System Info
                    document.getElementById('hostname').textContent = data.system_info.hostname;
                    document.getElementById('processor').textContent = data.system_info.processor;
                    document.getElementById('ip-address').textContent = data.system_info.ip_address;
                    document.getElementById('os').textContent = data.system_info.os;

                    // Update CPU Info
                    document.getElementById('cpu-usage').textContent = `${data.cpu.current.toFixed(1)}%`;
                    document.getElementById('cpu-freq').textContent = `${(data.cpu.frequency / 1000).toFixed(2)} GHz`;

                    // Update Memory Info
                    document.getElementById('memory-usage').textContent = `${data.memory.current.toFixed(1)}%`;
                    document.getElementById('memory-available').textContent = `${data.memory.details.available.toFixed(1)} GB`;
                    document.getElementById('memory-bar').style.width = `${data.memory.current}%`;
                    document.getElementById('memory-bar').className = `progress-bar ${
                        data.memory.current > 90 ? 'bg-danger' :
                        data.memory.current > 70 ? 'bg-warning' :
                        'bg-success'
                    }`;

                    // Update Network Info
                    document.getElementById('network-connections').textContent = data.network.connections;
                    const networkStats = document.getElementById('network-stats');
                    networkStats.innerHTML = '';
                    for (const [interface, stats] of Object.entries(data.network.interfaces)) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${interface}</td>
                            <td>${stats.bytes_sent.toFixed(2)} MB</td>
                            <td>${stats.bytes_recv.toFixed(2)} MB</td>
                        `;
                        networkStats.appendChild(row);
                    }

                    // Update Process List
                    const processList = document.getElementById('process-list');
                    processList.innerHTML = data.processes.map(proc => `
                        <div class="process-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>${proc.name}</strong>
                                    <small class="text-muted d-block">PID: ${proc.pid}</small>
                                </div>
                                <div class="text-end">
                                    <div class="badge bg-info">CPU: ${proc.cpu_percent.toFixed(1)}%</div>
                                    <div class="badge bg-warning">MEM: ${proc.memory_percent.toFixed(1)}%</div>
                                </div>
                            </div>
                        </div>
                    `).join('');

                    // Update Threat Level
                    const threatBadge = document.getElementById('threat-level');
                    threatBadge.textContent = data.threat;
                    threatBadge.className = `badge ${
                        data.threat === 'High' ? 'bg-danger' :
                        data.threat === 'Medium' ? 'bg-warning' :
                        data.threat === 'Low' ? 'bg-info' :
                        'bg-success'
                    }`;

                    // Update System Status
                    const statusBadge = document.getElementById('system-status');
                    statusBadge.textContent = data.status;
                    statusBadge.className = `badge ${
                        data.status === 'Critical' ? 'bg-danger' :
                        data.status === 'Warning' ? 'bg-warning' :
                        data.status === 'Attention' ? 'bg-info' :
                        'bg-success'
                    }`;

                    // Update Charts
                    const now = new Date().toLocaleTimeString();
                    
                    // CPU Chart
                    if (cpuChart.data.labels.length > 20) {
                        cpuChart.data.labels.shift();
                        cpuChart.data.datasets[0].data.shift();
                    }
                    cpuChart.data.labels.push(now);
                    cpuChart.data.datasets[0].data.push(data.cpu.current);
                    cpuChart.update();

                    // Memory Chart
                    if (memoryChart.data.labels.length > 20) {
                        memoryChart.data.labels.shift();
                        memoryChart.data.datasets[0].data.shift();
                    }
                    memoryChart.data.labels.push(now);
                    memoryChart.data.datasets[0].data.push(data.memory.current);
                    memoryChart.update();

                    // Threat Chart
                    if (threatChart.data.labels.length > 20) {
                        threatChart.data.labels.shift();
                        threatChart.data.datasets[0].data.shift();
                    }
                    threatChart.data.labels.push(now);
                    threatChart.data.datasets[0].data.push(
                        data.threat === 'High' ? 3 :
                        data.threat === 'Medium' ? 2 :
                        data.threat === 'Low' ? 1 : 0
                    );
                    threatChart.update();
                })
                .catch(error => console.error('Error updating dashboard:', error));
        }

        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            updateDashboard();
            setInterval(updateDashboard, 2000);
        });
    </script>
</body>
</html> 