<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rajwadi Security</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/cyber.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar d-flex flex-column align-items-start">
                <div class="w-100 mb-4 text-center">
                    <h2 class="fw-bold" style="font-family: 'Fira Mono', 'JetBrains Mono', monospace; letter-spacing: 2px; text-shadow: 0 0 16px var(--cyber-primary); color: var(--cyber-primary);">Rajwadi Security</h2>
                </div>
                <nav class="nav flex-column w-100">
                    <a class="nav-link active" href="/">
                        <i class="fas fa-chart-line"></i> Dashboard
                    </a>
                    <a class="nav-link" href="/eep">
                        <i class="fas fa-shield-alt"></i> EEP
                    </a>
                    <a class="nav-link" href="/log">
                        <i class="fas fa-list"></i> Log
                    </a>
                    <a class="nav-link" href="/soc_helper">
                        <i class="fas fa-user-secret"></i> SOC Helper (AI Help)
                    </a>
                    <a class="nav-link mt-4" href="/logout">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </nav>
            </div>
            <!-- Main Content -->
            <div class="col-md-10 p-4">
                <div class="dashboard-header card mb-4 text-center">
                    <h1 class="mb-2">Welcome to Your Cyber Security SOC Dashboard</h1>
                    <p class="lead">Monitor, analyze, and respond to threats in real time with a modern, neon cyber UI.</p>
                </div>
                <div class="dashboard-grid">
                    <!-- Modern Metrics Grid with More Real-Time Data -->
                    <div class="row g-4 mb-4">
                      <!-- CPU Usage Card -->
                      <div class="col-md-4">
                        <div class="card text-center h-100">
                          <div class="card-header bg-dark text-white">
                            <i class="fas fa-microchip me-2"></i> CPU Usage
                          </div>
                          <div class="card-body">
                            <div class="display-5 fw-bold mb-2" id="cpu-usage">{{ cpu.current }}%</div>
                            <div class="progress" style="height: 10px;">
                              <div id="cpu-bar" class="progress-bar bg-success" role="progressbar" style="width: {{ cpu.current }}%;"></div>
                            </div>
                            <div class="text-muted mt-2">Current Usage</div>
                          </div>
                        </div>
                      </div>
                      <!-- Memory Usage Card -->
                      <div class="col-md-4">
                        <div class="card text-center h-100">
                          <div class="card-header bg-dark text-white">
                            <i class="fas fa-memory me-2"></i> Memory Usage
                          </div>
                          <div class="card-body">
                            <div class="display-5 fw-bold mb-2" id="memory-usage">{{ memory.current }}%</div>
                            <div class="progress" style="height: 10px;">
                              <div id="memory-bar" class="progress-bar bg-info" role="progressbar" style="width: {{ memory.current }}%;"></div>
                            </div>
                            <div class="text-muted mt-2">Current Usage</div>
                          </div>
                        </div>
                      </div>
                      <!-- Threat Level Card -->
                      <div class="col-md-4">
                        <div class="card text-center h-100">
                          <div class="card-header bg-dark text-white">
                            <i class="fas fa-bolt me-2"></i> Threat Level
                          </div>
                          <div class="card-body">
                            <div class="display-5 fw-bold mb-2">
                              <span id="threat-level" class="badge" style="font-size:1.2em; background: #198754; color: #fff;">{{ threat }}</span>
                            </div>
                            <div class="text-muted mt-2">Current Threat Level</div>
                          </div>
                        </div>
                      </div>
                      <!-- Current Time Card -->
                      <div class="col-md-4">
                        <div class="card text-center h-100">
                          <div class="card-header bg-dark text-white">
                            <i class="fas fa-clock me-2"></i> Current Time
                          </div>
                          <div class="card-body">
                            <div class="display-5 fw-bold mb-2" id="current-time">--:--:--</div>
                            <div class="text-muted mt-2">Live</div>
                          </div>
                        </div>
                      </div>
                      <!-- Uptime Card -->
                      <div class="col-md-4">
                        <div class="card text-center h-100">
                          <div class="card-header bg-dark text-white">
                            <i class="fas fa-hourglass-half me-2"></i> Uptime
                          </div>
                          <div class="card-body">
                            <div class="display-5 fw-bold mb-2" id="uptime">--:--:--</div>
                            <div class="text-muted mt-2">Since Last Boot</div>
                          </div>
                        </div>
                      </div>
                      <!-- Disk Usage Card -->
                      <div class="col-md-4">
                        <div class="card text-center h-100">
                          <div class="card-header bg-dark text-white">
                            <i class="fas fa-hdd me-2"></i> Disk Usage
                          </div>
                          <div class="card-body">
                            <div class="display-5 fw-bold mb-2" id="disk-usage">--%</div>
                            <div class="text-muted mt-2">Used of Total</div>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize charts
        let cpuChart, memoryChart, threatChart;

        function initCharts() {
            // CPU Chart
            const cpuCtx = document.getElementById('cpuChart').getContext('2d');
            cpuChart = new Chart(cpuCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU Usage',
                        data: [],
                        borderColor: '#00ffae',
                        backgroundColor: 'rgba(0,255,174,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#00ffae' } },
                        title: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#00ffae' },
                            grid: { color: '#00ffae22' }
                        },
                        x: {
                            ticks: { color: '#00ffae' },
                            grid: { color: '#00ffae22' }
                        }
                    }
                }
            });

            // Memory Chart
            const memoryCtx = document.getElementById('memoryChart').getContext('2d');
            memoryChart = new Chart(memoryCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Memory Usage',
                        data: [],
                        borderColor: '#0066ff',
                        backgroundColor: 'rgba(0,102,255,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#0066ff' } },
                        title: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#0066ff' },
                            grid: { color: '#0066ff22' }
                        },
                        x: {
                            ticks: { color: '#0066ff' },
                            grid: { color: '#0066ff22' }
                        }
                    }
                }
            });

            // Threat Chart
            const threatCtx = document.getElementById('threatChart').getContext('2d');
            threatChart = new Chart(threatCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Threat Level',
                        data: [],
                        borderColor: '#ff4444',
                        backgroundColor: 'rgba(255,68,68,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#ff4444' } },
                        title: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 3,
                            ticks: {
                                color: '#ff4444',
                                callback: function(value) {
                                    return ['Normal','Low','Medium','High'][value];
                                }
                            },
                            grid: { color: '#ff444422' }
                        },
                        x: {
                            ticks: { color: '#ff4444' },
                            grid: { color: '#ff444422' }
                        }
                    }
                }
            });
        }

        function updateDashboard() {
            fetch('/api/security/metrics')
                .then(res => res.json())
                .then(data => {
                    // Update System Info
                    document.getElementById('hostname').textContent = data.system_info.hostname;
                    document.getElementById('processor').textContent = data.system_info.processor;
                    document.getElementById('ip-address').textContent = data.system_info.ip_address;
                    document.getElementById('os').textContent = data.system_info.os;

                    // Update CPU Info
                    document.getElementById('cpu-usage').textContent = `${data.cpu.current.toFixed(1)}%`;
                    document.getElementById('cpu-freq').textContent = `${(data.cpu.frequency / 1000).toFixed(2)} GHz`;

                    // Update Memory Info
                    document.getElementById('memory-usage').textContent = `${data.memory.current.toFixed(1)}%`;
                    document.getElementById('memory-available').textContent = `${data.memory.details.available.toFixed(1)} GB`;
                    document.getElementById('memory-bar').style.width = `${data.memory.current}%`;
                    document.getElementById('memory-bar').className = `progress-bar ${
                        data.memory.current > 90 ? 'bg-danger' :
                        data.memory.current > 70 ? 'bg-warning' :
                        'bg-success'
                    }`;

                    // Update Network Info
                    document.getElementById('network-connections').textContent = data.network.connections;
                    const networkStats = document.getElementById('network-stats');
                    networkStats.innerHTML = '';
                    for (const [interface, stats] of Object.entries(data.network.interfaces)) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${interface}</td>
                            <td>${stats.bytes_sent.toFixed(2)} MB</td>
                            <td>${stats.bytes_recv.toFixed(2)} MB</td>
                        `;
                        networkStats.appendChild(row);
                    }

                    // Update Process List
                    const processList = document.getElementById('process-list');
                    processList.innerHTML = data.processes.map(proc => `
                        <div class="process-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>${proc.name}</strong>
                                    <small class="text-muted d-block">PID: ${proc.pid}</small>
                                </div>
                                <div class="text-end">
                                    <div class="badge bg-info">CPU: ${proc.cpu_percent.toFixed(1)}%</div>
                                    <div class="badge bg-warning">MEM: ${proc.memory_percent.toFixed(1)}%</div>
                                </div>
                            </div>
                        </div>
                    `).join('');

                    // Update Threat Level
                    const threatBadge = document.getElementById('threat-level');
                    threatBadge.textContent = data.threat;
                    threatBadge.className = `badge ${
                        data.threat === 'High' ? 'bg-danger' :
                        data.threat === 'Medium' ? 'bg-warning' :
                        data.threat === 'Low' ? 'bg-info' :
                        'bg-success'
                    }`;

                    // Update System Status
                    const statusBadge = document.getElementById('system-status');
                    statusBadge.textContent = data.status;
                    statusBadge.className = `badge ${
                        data.status === 'Critical' ? 'bg-danger' :
                        data.status === 'Warning' ? 'bg-warning' :
                        data.status === 'Attention' ? 'bg-info' :
                        'bg-success'
                    }`;

                    // Update Charts
                    const now = new Date().toLocaleTimeString();
                    
                    // CPU Chart
                    if (cpuChart.data.labels.length > 20) {
                        cpuChart.data.labels.shift();
                        cpuChart.data.datasets[0].data.shift();
                    }
                    cpuChart.data.labels.push(now);
                    cpuChart.data.datasets[0].data.push(data.cpu.current);
                    cpuChart.update();

                    // Memory Chart
                    if (memoryChart.data.labels.length > 20) {
                        memoryChart.data.labels.shift();
                        memoryChart.data.datasets[0].data.shift();
                    }
                    memoryChart.data.labels.push(now);
                    memoryChart.data.datasets[0].data.push(data.memory.current);
                    memoryChart.update();

                    // Threat Chart
                    if (threatChart.data.labels.length > 20) {
                        threatChart.data.labels.shift();
                        threatChart.data.datasets[0].data.shift();
                    }
                    threatChart.data.labels.push(now);
                    threatChart.data.datasets[0].data.push(
                        data.threat === 'High' ? 3 :
                        data.threat === 'Medium' ? 2 :
                        data.threat === 'Low' ? 1 : 0
                    );
                    threatChart.update();

                    if (data.current_time !== undefined) {
                        document.getElementById('current-time').textContent = data.current_time;
                    }
                    if (data.uptime !== undefined) {
                        document.getElementById('uptime').textContent = data.uptime;
                    }
                    if (data.disk !== undefined) {
                        var disk = data.disk;
                        var percent = disk.percent !== undefined ? disk.percent : '--';
                        var totalGB = disk.total ? (disk.total / (1024*1024*1024)).toFixed(1) : '--';
                        document.getElementById('disk-usage').textContent = percent + '% of ' + totalGB + ' GB';
                    }
                })
                .catch(error => console.error('Error updating dashboard:', error));
        }

        // Auto-update System Overview table
        function updateSystemOverview() {
            fetch('/api/security/metrics')
                .then(res => res.json())
                .then(data => {
                    // Show raw JSON in debug area
                    document.getElementById('api-debug').textContent = JSON.stringify(data, null, 2);
                    if (data.system_info) {
                        document.getElementById('hostname').textContent = data.system_info.hostname || '';
                        document.getElementById('os').textContent = data.system_info.os || '';
                        document.getElementById('ip').textContent = data.system_info.ip_address || '';
                    }
                    if (data.cpu) {
                        document.getElementById('cpu-usage').textContent = (data.cpu.current !== undefined ? data.cpu.current + '%' : '');
                        // Update CPU progress bar
                        var cpuBar = document.getElementById('cpu-bar');
                        if (cpuBar && data.cpu.current !== undefined) {
                            cpuBar.style.width = data.cpu.current + '%';
                            cpuBar.className = 'progress-bar ' +
                                (data.cpu.current > 90 ? 'bg-danger' :
                                 data.cpu.current > 70 ? 'bg-warning' :
                                 'bg-success');
                        }
                    }
                    if (data.memory) {
                        document.getElementById('memory-usage').textContent = (data.memory.current !== undefined ? data.memory.current + '%' : '');
                        // Update Memory progress bar
                        var memBar = document.getElementById('memory-bar');
                        if (memBar && data.memory.current !== undefined) {
                            memBar.style.width = data.memory.current + '%';
                            memBar.className = 'progress-bar ' +
                                (data.memory.current > 90 ? 'bg-danger' :
                                 data.memory.current > 70 ? 'bg-warning' :
                                 'bg-info');
                        }
                    }
                    if (data.threat !== undefined) {
                        var threatLevel = document.getElementById('threat-level');
                        threatLevel.textContent = data.threat;
                        // Color the badge
                        if (data.threat === 'High') {
                            threatLevel.style.background = '#dc3545'; // red
                        } else if (data.threat === 'Medium' || data.threat === 'Low') {
                            threatLevel.style.background = '#ffc107'; // yellow
                        } else {
                            threatLevel.style.background = '#198754'; // green
                        }
                    }
                })
                .catch(err => {
                    document.getElementById('api-debug').textContent = 'Error: ' + err;
                });
        }

        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            updateDashboard();
            updateSystemOverview();
            setInterval(updateDashboard, 1000);
            setInterval(updateSystemOverview, 1000);
        });
    </script>
</body>
</html> 